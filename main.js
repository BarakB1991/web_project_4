!function(){"use strict";var e=class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}resetValidation(){const e=[...this._formElement.querySelectorAll(this._inputSelector)],t=this._formElement.querySelector(this._submitButtonSelector);e.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState(e,t)}_hideInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_toggleButtonState(e,t){e.some((e=>!e.validity.valid))?(t.classList.add(this._inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._inactiveButtonClass),t.disabled=!1)}_showInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_setEventListeners(){const e=[...this._formElement.querySelectorAll(this._inputSelector)],t=this._formElement.querySelector(this._submitButtonSelector);e.forEach((r=>{r.addEventListener("input",(()=>{this._checkInputValidity(r),this._toggleButtonState(e,t)}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}};function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class r{constructor(e){let{cardData:r,cardTemplateSelector:s,onImageClick:n,userId:o,handleDeleteCardClick:i,handleLikeCardClick:a}=e;t(this,"renderLikeContainer",(()=>{this._element.querySelector(".card__like-counter").textContent=this._likeCounter.length,this.isLikedByUser()?this._addLikeButton():this._removeLikeButton()})),t(this,"removeCardElement",(()=>{this._element.remove(),this._element=null})),t(this,"_addEventListeners",(()=>{this._element.querySelector(".card__like-btn").addEventListener("click",(e=>this._handleLikeCardClick(this._cardId)));const e=this._element.querySelector(".card__delete-btn");this._cardUserId===this._userId?e.addEventListener("click",(()=>this._handleDeleteCardClick(this._cardId))):e.remove(),this._element.querySelector(".card__img").addEventListener("click",(()=>this._handlePreviewPicture()))})),t(this,"_removeLikeButton",(()=>{this._element.querySelector(".card__like-btn").classList.remove("card__like-btn_active")})),t(this,"_addLikeButton",(()=>{this._element.querySelector(".card__like-btn").classList.add("card__like-btn_active")})),t(this,"_handlePreviewPicture",(()=>{this._onImageClick({link:this._link,name:this._name})})),t(this,"renderCard",(()=>{this._element=this._template.cloneNode(!0);const e=this._element.querySelector(".card__img"),t=this._element.querySelector(".card__like-counter");return e.src=this._link,e.alt=this._name,this._element.id=this._cardUserId,t.textContent=this._likeCounter.length,this._element.querySelector(".card__title").textContent=this._name,this._addEventListeners(),this.renderLikeContainer(),this._element})),this._name=r.name,this._link=r.link,this._cardUserId=r.owner._id,this._cardId=r._id,this._likeCounter=r.likes,this._userId=o,this._onImageClick=n,this._handleDeleteCardClick=i,this._handleLikeCardClick=a,this._template=document.querySelector(s).content.querySelector(".card")}isLikedByUser(){return this._likeCounter.some((e=>e._id===this._userId))}updateLikeCounter(e){this._likeCounter=e.likes,this.renderLikeContainer()}}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class n{constructor(e){s(this,"_handleMouseDown",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-btn"))&&this.close()})),s(this,"_handleEscClose",(e=>{e.preventDefault(),"Escape"===e.key&&this.close()})),this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_visible"),document.addEventListener("keyup",this._handleEscClose),this._popup.addEventListener("mousedown",this._handleMouseDown)}close(){this._popup.classList.remove("popup_visible"),document.removeEventListener("keyup",this._handleEscClose),this._popup.removeEventListener("mousedown",this._handleMouseDown)}}class o extends n{constructor(e,t){super(e),this.handleSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._originalButtonText=this._form.querySelector('button[type="submit"]').textContent}_getInputValues(){const e=[...this._form.querySelectorAll(".popup__input")],t={};return e.forEach((e=>{t[e.name]=e.value})),t}renderLoadingOnButton(){this._form.querySelector('button[type="submit"]').textContent="Saving..."}removeLoadingOnButton(){this._form.querySelector('button[type="submit"]').textContent=this._originalButtonText}setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this.handleSubmit(this._getInputValues())}))}open(){super.open()}close(){super.close(),this._form.reset()}}const i=document.querySelector(".popup_type_edit-profile"),a=document.querySelector(".popup_type_add-card"),l=document.querySelector(".popup_type_edit-avatar"),u=document.querySelector(".profile"),c=u.querySelector(".profile__name"),d=u.querySelector(".profile__about"),_=u.querySelector(".profile__img"),h=document.querySelector(".popup_type_image"),p=(h.querySelector(".popup__title_type_image"),h.querySelector(".popup__image"),u.querySelector(".profile__edit-btn")),m=u.querySelector(".profile__add-btn"),v=document.querySelector(".profile__img-button"),y=(document.querySelector(".cards__list"),{inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),b=(document.querySelector("#add-card-form"),document.querySelector("#edit-profile-form")),k=b.querySelector("#input-name"),C=b.querySelector("#input-profession");function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const L=new class{constructor(e){let{userName:t,userAbout:r,avatar:s,userId:n}=e;this._userName=t,this._userAbout=r,this._avatar=s,this._userId=n}getUserInfo(){return{userName:this._userName.textContent,userAbout:this._userAbout.textContent,avatar:this._avatar}}setUserInfo(e){let{userName:t,userAbout:r}=e;this._userName.textContent=t,this._userAbout.textContent=r}setUserAvatar(e){this._avatar.src=e,this._avatar.alt="Avatar"}setUserId(e){this._userId.id=e}}({userName:c,userAbout:d,avatar:_,userId:u}),S=new class{constructor(e){f(this,"removeUserCard",(e=>fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._token,"content-type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))))),f(this,"addLike",(e=>fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:this._token,"content-type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))))),f(this,"removeLike",(e=>fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this._token,"content-type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))))),f(this,"editAvatar",(e=>fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status)))))),this._url=e.baseUrl,this._token=e.token}promiseCardsAndUserData(){return Promise.all([this.getUserData(),this.getInitialCards()])}getInitialCards(){return fetch("".concat(this._url,"/cards"),{headers:{authorization:this._token}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}getUserData(){return fetch("".concat(this._url,"/users/me"),{headers:{authorization:this._token}}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}editProfile(e,t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})})}addNewCard(e,t){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:this._token,"content-type":"application/json"},body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject("Error: ".concat(e.status))))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",token:"c785e696-84a9-4aca-b3d2-750b2694b444"}),E=new class extends n{constructor(e){var t,r;super(e),r=()=>{this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()}))},(t="setEventListeners")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this._form=this._popup.querySelector(".popup__form")}submitHandler(e){this._submitHandler=e}renderLoadingOnButton(){this._form.querySelector('button[type="submit"]').textContent="Loading..."}removeLoadingOnButton(){this._form.querySelector('button[type="submit"]').textContent="Yes"}open(){super.open()}close(){super.close()}}(".popup_type_confirm");E.setEventListeners();const g=new class extends n{constructor(e){var t,r;super(e),r=e=>{let{link:t,name:r}=e;super.open();const s=this._popup.querySelector(".popup__title_type_image"),n=this._popup.querySelector(".popup__image");s.textContent=r,n.src=t,n.alt=r},(t="open")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this.open=r}}(".popup_type_image");function q(e){const t=new r({cardData:e,cardTemplateSelector:"#card-template",onImageClick:g.open,userId:u.id,handleDeleteCardClick:e=>{E.open(),E.submitHandler((()=>{S.removeUserCard(e).then(E.renderLoadingOnButton()).then((()=>{t.removeCardElement()})).catch((e=>console.log(e))).finally((()=>{E.close(),E.removeLoadingOnButton()}))}))},handleLikeCardClick:e=>{1==t.isLikedByUser()?S.removeLike(e).then((e=>t.updateLikeCounter(e))):S.addLike(e).then((e=>t.updateLikeCounter(e)))}}),s=t.renderCard();I.addItem(s)}const I=new class{constructor(e,t){let{renderer:r}=t;this._renderer=r,this._container=document.querySelector(e)}addItem(e){this._container.prepend(e)}renderer(e){this._items=e,this._items.forEach((e=>{this._renderer(e)}))}}(".cards__list",{renderer:q}),B=new o(".popup_type_edit-profile",(async e=>{let{name:t,profession:r}=e;B.renderLoadingOnButton();const s=await S.editProfile(t,r);Promise.resolve(s)&&(L.setUserInfo({userName:t,userAbout:r}),B.close(),B.removeLoadingOnButton())})),w=new o(".popup_type_add-card",(async e=>{const{cardtitle:t,imagelink:r}=e;w.renderLoadingOnButton();const s=await S.addNewCard(t,r);s&&(q(s),w.close(),w.removeLoadingOnButton())})),j=new o(".popup_type_edit-avatar",(async e=>{const{avatar:t}=e;j.renderLoadingOnButton();const r=await S.editAvatar(t);Promise.resolve(r)?(L.setUserAvatar(t),j.close(),j.removeLoadingOnButton()):console.log(Promise.reject(r))}));B.setEventListeners(),w.setEventListeners(),j.setEventListeners();const P=new e(y,a),U=new e(y,i),A=new e(y,l);v.addEventListener("click",(()=>{j.open(),A.resetValidation()})),p.addEventListener("click",(()=>{B.open();const{userName:e,userAbout:t}=L.getUserInfo();k.value=e,C.value=t})),m.addEventListener("click",(()=>{w.open(),P.resetValidation()})),P.enableValidation(),U.enableValidation(),A.enableValidation(),S.promiseCardsAndUserData().then((e=>{let[t,r]=e;L.setUserInfo({userName:t.name,userAbout:t.about}),L.setUserAvatar(t.avatar),L.setUserId(t._id),I.renderer(r)})).catch((e=>console.log(e)))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3ZDVCxFQUFVbEIsTUFBUXFCLEVBQ2xCRixFQUFnQm5CLE1BQVFzQixLQUcxQlIsRUFBeUI5RSxpQkFBaUIsU0FBUyxLQUNqRGdLLEVBQW1CN0csT0FDbkJxSCxFQUFrQi9MLHFCQUdwQitMLEVBQWtCdkssbUJBQ2xCeUssRUFBcUJ6SyxtQkFDckIwSyxFQUFvQjFLLG1CQUVwQjhGLEVBQ0dxQiwwQkFDQVosTUFBSyxJQUF1QixJQUFyQm9FLEVBQVVDLEdBQVcsRUFDM0J6RixFQUFTUSxZQUFZLENBQ25CUCxTQUFVdUYsRUFBU2pKLEtBQ25CMkQsVUFBV3NGLEVBQVNsRCxRQUV0QnRDLEVBQVNTLGNBQWMrRSxFQUFTckYsUUFDaENILEVBQVNVLFVBQVU4RSxFQUFTdEksS0FDNUIyRyxFQUFZRyxTQUFTeUIsTUFFdEJyQyxPQUFNQyxHQUFPQyxRQUFRQyxJQUFJRixLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9zY3JpcHRzL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvc2NyaXB0cy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3NjcmlwdHMvY29tcG9uZW50cy9TZWN0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCkge1xyXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcclxuXHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgY29uc3QgaW5wdXRFbGVtZW50cyA9IFsuLi50aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXTtcclxuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICAgIGlucHV0RWxlbWVudHMuZm9yRWFjaChpbnB1dEVsZW1lbnQgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZShpbnB1dEVsZW1lbnRzLCBidXR0b25FbGVtZW50KTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuXHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVCdXR0b25TdGF0ZShpbnB1dEVsZW1lbnRzLCBidXR0b25FbGVtZW50KSB7XHJcbiAgICBjb25zdCBoYXNJbnZhbGlkSW5wdXQgPSBpbnB1dEVsZW1lbnRzLnNvbWUoaW5wdXRFbGVtZW50ID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xyXG4gICAgaWYgKGhhc0ludmFsaWRJbnB1dCkge1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcblxyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcclxuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcclxuICAgIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBjb25zdCBpbnB1dEVsZW1lbnRzID0gWy4uLnRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcildOyAvLyBtYWRlIGFycmF5IG9mIG5vZGVMaXN0XHJcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gICAgaW5wdXRFbGVtZW50cy5mb3JFYWNoKGlucHV0RWxlbWVudCA9PiB7XHJcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KTtcclxuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZShpbnB1dEVsZW1lbnRzLCBidXR0b25FbGVtZW50KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBldnQgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEZvcm1WYWxpZGF0b3I7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIGNvbnN0cnVjdG9yKHtjYXJkRGF0YSwgY2FyZFRlbXBsYXRlU2VsZWN0b3IsIG9uSW1hZ2VDbGljaywgdXNlcklkLCBoYW5kbGVEZWxldGVDYXJkQ2xpY2ssIGhhbmRsZUxpa2VDYXJkQ2xpY2t9KSB7XHJcbiAgICB0aGlzLl9uYW1lID0gY2FyZERhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBjYXJkRGF0YS5saW5rO1xyXG4gICAgdGhpcy5fY2FyZFVzZXJJZCA9IGNhcmREYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX2NhcmRJZCA9IGNhcmREYXRhLl9pZDtcclxuICAgIHRoaXMuX2xpa2VDb3VudGVyID0gY2FyZERhdGEubGlrZXM7XHJcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XHJcblxyXG4gICAgdGhpcy5fb25JbWFnZUNsaWNrID0gb25JbWFnZUNsaWNrO1xyXG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZENsaWNrID0gaGFuZGxlRGVsZXRlQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5faGFuZGxlTGlrZUNhcmRDbGljayA9IGhhbmRsZUxpa2VDYXJkQ2xpY2s7XHJcblxyXG4gICAgdGhpcy5fdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNhcmRUZW1wbGF0ZVNlbGVjdG9yKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkJyk7XHJcbiAgfVxyXG5cclxuICBpc0xpa2VkQnlVc2VyKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xpa2VDb3VudGVyLnNvbWUobGlrZSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fdXNlcklkKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUxpa2VDb3VudGVyKGNhcmREYXRhKSB7XHJcbiAgICB0aGlzLl9saWtlQ291bnRlciA9IGNhcmREYXRhLmxpa2VzO1xyXG4gICAgdGhpcy5yZW5kZXJMaWtlQ29udGFpbmVyKCk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJMaWtlQ29udGFpbmVyID0gKCkgPT4ge1xyXG4gICAgY29uc3QgbGlrZUNvdW50ZXIgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50ZXInKTtcclxuICAgIGxpa2VDb3VudGVyLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZUNvdW50ZXIubGVuZ3RoO1xyXG5cclxuICAgICF0aGlzLmlzTGlrZWRCeVVzZXIoKSA/IHRoaXMuX3JlbW92ZUxpa2VCdXR0b24oKSA6IHRoaXMuX2FkZExpa2VCdXR0b24oKTtcclxuICB9O1xyXG5cclxuICByZW1vdmVDYXJkRWxlbWVudCA9ICgpID0+IHtcclxuICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcclxuICB9O1xyXG5cclxuICBfYWRkRXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idG4nKTtcclxuICAgIGxpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBldnQgPT4gdGhpcy5faGFuZGxlTGlrZUNhcmRDbGljayh0aGlzLl9jYXJkSWQpKTtcclxuXHJcbiAgICBjb25zdCBkZWxldGVDYXJkQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ0bicpO1xyXG4gICAgaWYgKHRoaXMuX2NhcmRVc2VySWQgPT09IHRoaXMuX3VzZXJJZCkge1xyXG4gICAgICBkZWxldGVDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5faGFuZGxlRGVsZXRlQ2FyZENsaWNrKHRoaXMuX2NhcmRJZCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVsZXRlQ2FyZEJ1dHRvbi5yZW1vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwcmV2aWV3UGljdHVyZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltZycpO1xyXG4gICAgcHJldmlld1BpY3R1cmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLl9oYW5kbGVQcmV2aWV3UGljdHVyZSgpKTtcclxuICB9O1xyXG5cclxuICBfcmVtb3ZlTGlrZUJ1dHRvbiA9ICgpID0+IHtcclxuICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ0bicpO1xyXG4gICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdjYXJkX19saWtlLWJ0bl9hY3RpdmUnKTtcclxuICB9O1xyXG5cclxuICBfYWRkTGlrZUJ1dHRvbiA9ICgpID0+IHtcclxuICAgIGNvbnN0IGxpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ0bicpO1xyXG4gICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ0bl9hY3RpdmUnKTtcclxuICB9O1xyXG5cclxuICBfaGFuZGxlUHJldmlld1BpY3R1cmUgPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9vbkltYWdlQ2xpY2soe2xpbms6IHRoaXMuX2xpbmssIG5hbWU6IHRoaXMuX25hbWV9KTtcclxuICB9O1xyXG5cclxuICByZW5kZXJDYXJkID0gKCkgPT4ge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX3RlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIGNvbnN0IGNhcmRJbWFnZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltZycpO1xyXG4gICAgY29uc3QgY2FyZExpa2VDb3VudGVyID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudGVyJyk7XHJcbiAgICBjYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIGNhcmRJbWFnZS5hbHQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fZWxlbWVudC5pZCA9IHRoaXMuX2NhcmRVc2VySWQ7XHJcbiAgICBjYXJkTGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlQ291bnRlci5sZW5ndGg7XHJcbiAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJMaWtlQ29udGFpbmVyKCk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfTtcclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX3Zpc2libGUnKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5faGFuZGxlTW91c2VEb3duKTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfdmlzaWJsZScpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB0aGlzLl9wb3B1cC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9oYW5kbGVNb3VzZURvd24pO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZU1vdXNlRG93biA9IGV2dCA9PiB7XHJcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwJykgfHwgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwX19jbG9zZS1idG4nKSkge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlID0gZXZ0ID0+IHtcclxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKGV2dC5rZXkgPT09ICdFc2NhcGUnKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9O1xyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tICcuL1BvcHVwLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlU3VibWl0KSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTsgLy8gdGhpcy5fcG9wdXBcclxuICAgIHRoaXMuaGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xyXG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpO1xyXG4gICAgdGhpcy5fb3JpZ2luYWxCdXR0b25UZXh0ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKCdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLnRleHRDb250ZW50O1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRzID0gWy4uLnRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19pbnB1dCcpXTtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcblxyXG4gICAgaW5wdXRzLmZvckVhY2goaW5wdXQgPT4ge1xyXG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyTG9hZGluZ09uQnV0dG9uKCkge1xyXG4gICAgdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKCdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLnRleHRDb250ZW50ID0gJ1NhdmluZy4uLic7XHJcbiAgfVxyXG5cclxuICByZW1vdmVMb2FkaW5nT25CdXR0b24oKSB7XHJcbiAgICB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJykudGV4dENvbnRlbnQgPSB0aGlzLl9vcmlnaW5hbEJ1dHRvblRleHQ7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZXZ0ID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMuaGFuZGxlU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xyXG4gIH1cclxufVxyXG4iLCIvLyBFbGVtZW50c1xyXG5leHBvcnQgY29uc3QgZWRpdFByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQtcHJvZmlsZScpO1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfYWRkLWNhcmQnKTtcclxuZXhwb3J0IGNvbnN0IGVkaXRBdmF0YXJQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQtYXZhdGFyJyk7XHJcblxyXG5leHBvcnQgY29uc3QgcHJvZmlsZUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZSA9IHByb2ZpbGVDb250YWluZXIucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX25hbWUnKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVQcm9mZXNzaW9uID0gcHJvZmlsZUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWJvdXQnKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVBdmF0YXIgPSBwcm9maWxlQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19pbWcnKTtcclxuXHJcbi8vIEltYWdlIFBvcHVwIEVsZW1lbnRzXHJcbmV4cG9ydCBjb25zdCBpbWFnZVBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGltYWdlUG9wdXBUaXRsZUVsZW1lbnQgPSBpbWFnZVBvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fdGl0bGVfdHlwZV9pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgaW1hZ2VQb3B1cEltYWdlRWxlbWVudCA9IGltYWdlUG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpO1xyXG5cclxuLy9CdXR0b25zXHJcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IHByb2ZpbGVDb250YWluZXIucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnRuJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlQWRkQ2FyZEZvcm1CdXR0b24gPSBwcm9maWxlQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnRuJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlQXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltZy1idXR0b24nKTtcclxuXHJcbmV4cG9ydCBjb25zdCBjYXJkVGVtcGxhdGVTZWxlY3RvciA9ICcjY2FyZC10ZW1wbGF0ZSc7XHJcbmV4cG9ydCBjb25zdCBjYXJkc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkc19fbGlzdCcpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGZvcm1TZXR0aW5ncyA9IHtcclxuICBpbnB1dFNlbGVjdG9yOiAnLnBvcHVwX19pbnB1dCcsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcucG9wdXBfX3N1Ym1pdC1idG4nLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdwb3B1cF9fc3VibWl0LWJ0bl9kaXNhYmxlZCcsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2lucHV0X3R5cGVfZXJyb3InLFxyXG4gIGVycm9yQ2xhc3M6ICdwb3B1cF9fZXJyb3JfdmlzaWJsZSdcclxufTtcclxuXHJcbi8vIEZvcm1zIGVsZW1lbnRzXHJcbmV4cG9ydCBjb25zdCBjYXJkQWRkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhZGQtY2FyZC1mb3JtJyk7XHJcbmV4cG9ydCBjb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZWRpdC1wcm9maWxlLWZvcm0nKTtcclxuXHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcignI2lucHV0LW5hbWUnKTtcclxuZXhwb3J0IGNvbnN0IHByb2Zlc3Npb25JbnB1dCA9IGVkaXRQcm9maWxlRm9ybS5xdWVyeVNlbGVjdG9yKCcjaW5wdXQtcHJvZmVzc2lvbicpO1xyXG4iLCJpbXBvcnQgJy4uLy4uL3BhZ2VzL2luZGV4LmNzcyc7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gJy4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyc7XHJcbmltcG9ydCBDYXJkIGZyb20gJy4uL2NvbXBvbmVudHMvQ2FyZC5qcyc7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gJy4uL2NvbXBvbmVudHMvU2VjdGlvbi5qcyc7XHJcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tICcuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlJztcclxuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSAnLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtJztcclxuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tICcuLi9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyc7XHJcbmltcG9ydCB7XHJcbiAgZWRpdFByb2ZpbGVQb3B1cCxcclxuICBhZGRDYXJkUG9wdXAsXHJcbiAgZWRpdEF2YXRhclBvcHVwLFxyXG4gIHByb2Zlc3Npb25JbnB1dCxcclxuICBuYW1lSW5wdXQsXHJcbiAgcHJvZmlsZU5hbWUsXHJcbiAgcHJvZmlsZVByb2Zlc3Npb24sXHJcbiAgcHJvZmlsZUVkaXRCdXR0b24sXHJcbiAgcHJvZmlsZUFkZENhcmRGb3JtQnV0dG9uLFxyXG4gIGNhcmRUZW1wbGF0ZVNlbGVjdG9yLFxyXG4gIHByb2ZpbGVBdmF0YXIsXHJcbiAgcHJvZmlsZUNvbnRhaW5lcixcclxuICBwcm9maWxlQXZhdGFyQnV0dG9uLFxyXG4gIGZvcm1TZXR0aW5nc1xyXG59IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50cy5qcyc7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tICcuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzJztcclxuaW1wb3J0IEFwaSBmcm9tICcuLi9jb21wb25lbnRzL0FwaS5qcyc7XHJcblxyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XHJcbiAgdXNlck5hbWU6IHByb2ZpbGVOYW1lLFxyXG4gIHVzZXJBYm91dDogcHJvZmlsZVByb2Zlc3Npb24sXHJcbiAgYXZhdGFyOiBwcm9maWxlQXZhdGFyLFxyXG4gIHVzZXJJZDogcHJvZmlsZUNvbnRhaW5lclxyXG59KTtcclxuXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6ICdodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyJyxcclxuICB0b2tlbjogJ2M3ODVlNjk2LTg0YTktNGFjYS1iM2QyLTc1MGIyNjk0YjQ0NCdcclxufSk7XHJcblxyXG5jb25zdCBjb25maXJtYXRpb25Qb3B1cCA9IG5ldyBQb3B1cFdpdGhDb25maXJtYXRpb24oJy5wb3B1cF90eXBlX2NvbmZpcm0nKTtcclxuY29uZmlybWF0aW9uUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IGltYWdlUG9wdXBXaW5kb3cgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoJy5wb3B1cF90eXBlX2ltYWdlJyk7XHJcblxyXG4vLyBJbml0aWFsaXplICBjYXJkc1xyXG5mdW5jdGlvbiByZW5kZXJDYXJkKGl0ZW0pIHtcclxuICBjb25zdCBuZXdDYXJkID0gbmV3IENhcmQoe1xyXG4gICAgY2FyZERhdGE6IGl0ZW0sXHJcbiAgICBjYXJkVGVtcGxhdGVTZWxlY3RvcixcclxuICAgIG9uSW1hZ2VDbGljazogaW1hZ2VQb3B1cFdpbmRvdy5vcGVuLFxyXG4gICAgdXNlcklkOiBwcm9maWxlQ29udGFpbmVyLmlkLFxyXG4gICAgaGFuZGxlRGVsZXRlQ2FyZENsaWNrOiBpZCA9PiB7XHJcbiAgICAgIGNvbmZpcm1hdGlvblBvcHVwLm9wZW4oKTtcclxuICAgICAgY29uZmlybWF0aW9uUG9wdXAuc3VibWl0SGFuZGxlcigoKSA9PiB7XHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAucmVtb3ZlVXNlckNhcmQoaWQpXHJcbiAgICAgICAgICAudGhlbihjb25maXJtYXRpb25Qb3B1cC5yZW5kZXJMb2FkaW5nT25CdXR0b24oKSlcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgbmV3Q2FyZC5yZW1vdmVDYXJkRWxlbWVudCgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgICAgY29uZmlybWF0aW9uUG9wdXAuY2xvc2UoKTtcclxuICAgICAgICAgICAgY29uZmlybWF0aW9uUG9wdXAucmVtb3ZlTG9hZGluZ09uQnV0dG9uKCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgaGFuZGxlTGlrZUNhcmRDbGljazogaWQgPT4ge1xyXG4gICAgICBjb25zdCBpc0xpa2VkQnlVc2VyID0gbmV3Q2FyZC5pc0xpa2VkQnlVc2VyKCk7XHJcbiAgICAgIGlmIChpc0xpa2VkQnlVc2VyID09IHRydWUpIHtcclxuICAgICAgICBhcGkucmVtb3ZlTGlrZShpZCkudGhlbihjYXJkID0+IG5ld0NhcmQudXBkYXRlTGlrZUNvdW50ZXIoY2FyZCkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFwaS5hZGRMaWtlKGlkKS50aGVuKGNhcmQgPT4gbmV3Q2FyZC51cGRhdGVMaWtlQ291bnRlcihjYXJkKSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IG5ld0NhcmQucmVuZGVyQ2FyZCgpO1xyXG4gIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xyXG59XHJcblxyXG4vL0luaXRpYWxpemEgQ2FyZHNcclxuY29uc3QgY2FyZFNlY3Rpb24gPSBuZXcgU2VjdGlvbignLmNhcmRzX19saXN0Jywge1xyXG4gIHJlbmRlcmVyOiByZW5kZXJDYXJkXHJcbn0pO1xyXG5cclxuY29uc3QgcHJvZmlsZVBvcHVwV2luZG93ID0gbmV3IFBvcHVwV2l0aEZvcm0oJy5wb3B1cF90eXBlX2VkaXQtcHJvZmlsZScsIGFzeW5jICh7bmFtZTogdXNlck5hbWUsIHByb2Zlc3Npb246IHVzZXJBYm91dH0pID0+IHtcclxuICBwcm9maWxlUG9wdXBXaW5kb3cucmVuZGVyTG9hZGluZ09uQnV0dG9uKCk7XHJcbiAgY29uc3QgcHJvbWlzZUluZm8gPSBhd2FpdCBhcGkuZWRpdFByb2ZpbGUodXNlck5hbWUsIHVzZXJBYm91dCk7XHJcbiAgaWYgKFByb21pc2UucmVzb2x2ZShwcm9taXNlSW5mbykpIHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHt1c2VyTmFtZSwgdXNlckFib3V0fSk7XHJcbiAgICBwcm9maWxlUG9wdXBXaW5kb3cuY2xvc2UoKTtcclxuICAgIHByb2ZpbGVQb3B1cFdpbmRvdy5yZW1vdmVMb2FkaW5nT25CdXR0b24oKTtcclxuICB9XHJcbn0pO1xyXG5cclxuY29uc3QgYWRkQ2FyZFBvcHVwV2luZG93ID0gbmV3IFBvcHVwV2l0aEZvcm0oJy5wb3B1cF90eXBlX2FkZC1jYXJkJywgYXN5bmMgZGF0YSA9PiB7XHJcbiAgY29uc3Qge2NhcmR0aXRsZTogbmFtZSwgaW1hZ2VsaW5rOiBsaW5rfSA9IGRhdGE7XHJcbiAgYWRkQ2FyZFBvcHVwV2luZG93LnJlbmRlckxvYWRpbmdPbkJ1dHRvbigpO1xyXG4gIGNvbnN0IGNhcmQgPSBhd2FpdCBhcGkuYWRkTmV3Q2FyZChuYW1lLCBsaW5rKTtcclxuICBpZiAoY2FyZCkge1xyXG4gICAgcmVuZGVyQ2FyZChjYXJkKTtcclxuICAgIGFkZENhcmRQb3B1cFdpbmRvdy5jbG9zZSgpO1xyXG4gICAgYWRkQ2FyZFBvcHVwV2luZG93LnJlbW92ZUxvYWRpbmdPbkJ1dHRvbigpO1xyXG4gIH1cclxufSk7XHJcblxyXG5jb25zdCBlZGl0QXZhdGFyUG9wdXBXaW5kb3cgPSBuZXcgUG9wdXBXaXRoRm9ybSgnLnBvcHVwX3R5cGVfZWRpdC1hdmF0YXInLCBhc3luYyBhdmF0YXIgPT4ge1xyXG4gIGNvbnN0IHthdmF0YXI6IGF2YXRhclVybH0gPSBhdmF0YXI7XHJcbiAgZWRpdEF2YXRhclBvcHVwV2luZG93LnJlbmRlckxvYWRpbmdPbkJ1dHRvbigpO1xyXG4gIGNvbnN0IHNlbmRBdmF0YXIgPSBhd2FpdCBhcGkuZWRpdEF2YXRhcihhdmF0YXJVcmwpO1xyXG4gIGlmIChQcm9taXNlLnJlc29sdmUoc2VuZEF2YXRhcikpIHtcclxuICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIoYXZhdGFyVXJsKTtcclxuICAgIGVkaXRBdmF0YXJQb3B1cFdpbmRvdy5jbG9zZSgpO1xyXG4gICAgZWRpdEF2YXRhclBvcHVwV2luZG93LnJlbW92ZUxvYWRpbmdPbkJ1dHRvbigpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zb2xlLmxvZyhQcm9taXNlLnJlamVjdChzZW5kQXZhdGFyKSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbnByb2ZpbGVQb3B1cFdpbmRvdy5zZXRFdmVudExpc3RlbmVycygpO1xyXG5hZGRDYXJkUG9wdXBXaW5kb3cuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuZWRpdEF2YXRhclBvcHVwV2luZG93LnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5jb25zdCBjYXJkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1TZXR0aW5ncywgYWRkQ2FyZFBvcHVwKTtcclxuY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtU2V0dGluZ3MsIGVkaXRQcm9maWxlUG9wdXApO1xyXG5jb25zdCBhdmF0YXJGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybVNldHRpbmdzLCBlZGl0QXZhdGFyUG9wdXApO1xyXG5cclxucHJvZmlsZUF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBlZGl0QXZhdGFyUG9wdXBXaW5kb3cub3BlbigpO1xyXG4gIGF2YXRhckZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgcHJvZmlsZVBvcHVwV2luZG93Lm9wZW4oKTtcclxuICBjb25zdCB7dXNlck5hbWUsIHVzZXJBYm91dH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpOyAvLyBnZXQgb2JqZWN0IG9mIGN1cnJlbnQgbmFtZSBhbmQgcHJvZmVzc2lvblxyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJOYW1lO1xyXG4gIHByb2Zlc3Npb25JbnB1dC52YWx1ZSA9IHVzZXJBYm91dDtcclxufSk7XHJcblxyXG5wcm9maWxlQWRkQ2FyZEZvcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgYWRkQ2FyZFBvcHVwV2luZG93Lm9wZW4oKTtcclxuICBjYXJkRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcclxufSk7XHJcblxyXG5jYXJkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbnByb2ZpbGVGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuYXZhdGFyRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5hcGlcclxuICAucHJvbWlzZUNhcmRzQW5kVXNlckRhdGEoKVxyXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzXSkgPT4ge1xyXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xyXG4gICAgICB1c2VyTmFtZTogdXNlckRhdGEubmFtZSxcclxuICAgICAgdXNlckFib3V0OiB1c2VyRGF0YS5hYm91dFxyXG4gICAgfSk7XHJcbiAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHVzZXJEYXRhLmF2YXRhcik7XHJcbiAgICB1c2VySW5mby5zZXRVc2VySWQodXNlckRhdGEuX2lkKTtcclxuICAgIGNhcmRTZWN0aW9uLnJlbmRlcmVyKGNhcmRzKTtcclxuICB9KVxyXG4gIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih7dXNlck5hbWUsIHVzZXJBYm91dCwgYXZhdGFyLCB1c2VySWR9KSB7XHJcbiAgICB0aGlzLl91c2VyTmFtZSA9IHVzZXJOYW1lO1xyXG4gICAgdGhpcy5fdXNlckFib3V0ID0gdXNlckFib3V0O1xyXG4gICAgdGhpcy5fYXZhdGFyID0gYXZhdGFyO1xyXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1c2VyTmFtZTogdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgIHVzZXJBYm91dDogdGhpcy5fdXNlckFib3V0LnRleHRDb250ZW50LFxyXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhclxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKHt1c2VyTmFtZSwgdXNlckFib3V0fSkge1xyXG4gICAgdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQgPSB1c2VyTmFtZTtcclxuICAgIHRoaXMuX3VzZXJBYm91dC50ZXh0Q29udGVudCA9IHVzZXJBYm91dDtcclxuICB9XHJcblxyXG4gIHNldFVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICB0aGlzLl9hdmF0YXIuc3JjID0gYXZhdGFyO1xyXG4gICAgdGhpcy5fYXZhdGFyLmFsdCA9ICdBdmF0YXInO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlcklkKHVzZXJJZCkge1xyXG4gICAgdGhpcy5fdXNlcklkLmlkID0gdXNlcklkO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcclxuICAgIHRoaXMuX3VybCA9IG9wdGlvbnMuYmFzZVVybDtcclxuICAgIHRoaXMuX3Rva2VuID0gb3B0aW9ucy50b2tlbjtcclxuICB9XHJcblxyXG4gIHByb21pc2VDYXJkc0FuZFVzZXJEYXRhKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJEYXRhKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl91cmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB7YXV0aG9yaXphdGlvbjogdGhpcy5fdG9rZW59XHJcbiAgICB9KS50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckRhdGEoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczoge2F1dGhvcml6YXRpb246IHRoaXMuX3Rva2VufVxyXG4gICAgfSkudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVkaXRQcm9maWxlKHVzZXJOYW1lLCB1c2VyQWJvdXQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl91cmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl90b2tlbixcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiB1c2VyTmFtZSxcclxuICAgICAgICBhYm91dDogdXNlckFib3V0XHJcbiAgICAgIH0pXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZE5ld0NhcmQobmFtZSwgbGluaykge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX3VybH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fdG9rZW4sXHJcbiAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBsaW5rOiBsaW5rXHJcbiAgICAgIH0pXHJcbiAgICB9KS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW1vdmVVc2VyQ2FyZCA9IGNhcmRJZCA9PiB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBhdXRob3JpemF0aW9uOiB0aGlzLl90b2tlbixcclxuICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH1cclxuICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICBpZiAocmVzcG9uc2Uub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBhZGRMaWtlID0gY2FyZElkID0+IHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl91cmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX3Rva2VuLFxyXG4gICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgfVxyXG4gICAgfSkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHJlbW92ZUxpa2UgPSBjYXJkSWQgPT4ge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX3VybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fdG9rZW4sXHJcbiAgICAgICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICB9XHJcbiAgICB9KS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgZWRpdEF2YXRhciA9IGF2YXRhciA9PiB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fdXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX3Rva2VuLFxyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe2F2YXRhcn0pXHJcbiAgICB9KS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSAnLi9Qb3B1cC5qcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7IC8vIHRoaXMuX3BvcHVwXHJcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtJyk7XHJcbiAgfVxyXG5cclxuICBzdWJtaXRIYW5kbGVyKGNhbGwpIHtcclxuICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIgPSBjYWxsO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGV2dCA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZW5kZXJMb2FkaW5nT25CdXR0b24oKSB7XHJcbiAgICB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJykudGV4dENvbnRlbnQgPSAnTG9hZGluZy4uLic7XHJcbiAgfVxyXG5cclxuICByZW1vdmVMb2FkaW5nT25CdXR0b24oKSB7XHJcbiAgICB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJykudGV4dENvbnRlbnQgPSAnWWVzJztcclxuICB9XHJcblxyXG4gIG9wZW4oKSB7XHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tICcuL1BvcHVwLmpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgb3BlbiA9ICh7bGluaywgbmFtZX0pID0+IHtcclxuICAgIHN1cGVyLm9wZW4oKTtcclxuXHJcbiAgICBjb25zdCBpbWFnZVBvcHVwVGl0bGVFbGVtZW50ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX190aXRsZV90eXBlX2ltYWdlJyk7XHJcbiAgICBjb25zdCBpbWFnZVBvcHVwSW1hZ2VFbGVtZW50ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpO1xyXG5cclxuICAgIGltYWdlUG9wdXBUaXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgaW1hZ2VQb3B1cEltYWdlRWxlbWVudC5zcmMgPSBsaW5rO1xyXG4gICAgaW1hZ2VQb3B1cEltYWdlRWxlbWVudC5hbHQgPSBuYW1lO1xyXG4gIH07XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoY29udGFpbmVyU2VsZWN0b3IsIHtyZW5kZXJlcn0pIHtcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJlcihpdGVtcykge1xyXG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXRFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b25FbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImZvckVhY2giLCJpbnB1dEVsZW1lbnQiLCJfaGlkZUlucHV0RXJyb3IiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJlcnJvckVsZW1lbnQiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRleHRDb250ZW50Iiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJhZGQiLCJkaXNhYmxlZCIsIl9zaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJDYXJkIiwiY2FyZERhdGEiLCJjYXJkVGVtcGxhdGVTZWxlY3RvciIsIm9uSW1hZ2VDbGljayIsInVzZXJJZCIsImhhbmRsZURlbGV0ZUNhcmRDbGljayIsImhhbmRsZUxpa2VDYXJkQ2xpY2siLCJfZWxlbWVudCIsIl9saWtlQ291bnRlciIsImxlbmd0aCIsImlzTGlrZWRCeVVzZXIiLCJfYWRkTGlrZUJ1dHRvbiIsIl9yZW1vdmVMaWtlQnV0dG9uIiwiX2hhbmRsZUxpa2VDYXJkQ2xpY2siLCJfY2FyZElkIiwiZGVsZXRlQ2FyZEJ1dHRvbiIsIl9jYXJkVXNlcklkIiwiX3VzZXJJZCIsIl9oYW5kbGVEZWxldGVDYXJkQ2xpY2siLCJfaGFuZGxlUHJldmlld1BpY3R1cmUiLCJfb25JbWFnZUNsaWNrIiwibGluayIsIl9saW5rIiwibmFtZSIsIl9uYW1lIiwiX3RlbXBsYXRlIiwiY2xvbmVOb2RlIiwiY2FyZEltYWdlIiwiY2FyZExpa2VDb3VudGVyIiwic3JjIiwiYWx0IiwiX2FkZEV2ZW50TGlzdGVuZXJzIiwicmVuZGVyTGlrZUNvbnRhaW5lciIsIm93bmVyIiwiX2lkIiwibGlrZXMiLCJkb2N1bWVudCIsImNvbnRlbnQiLCJsaWtlIiwidXBkYXRlTGlrZUNvdW50ZXIiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJ0YXJnZXQiLCJjb250YWlucyIsImNsb3NlIiwia2V5IiwiX3BvcHVwIiwib3BlbiIsIl9oYW5kbGVFc2NDbG9zZSIsIl9oYW5kbGVNb3VzZURvd24iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2Zvcm0iLCJfb3JpZ2luYWxCdXR0b25UZXh0IiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwicmVuZGVyTG9hZGluZ09uQnV0dG9uIiwicmVtb3ZlTG9hZGluZ09uQnV0dG9uIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJyZXNldCIsImVkaXRQcm9maWxlUG9wdXAiLCJhZGRDYXJkUG9wdXAiLCJlZGl0QXZhdGFyUG9wdXAiLCJwcm9maWxlQ29udGFpbmVyIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlUHJvZmVzc2lvbiIsInByb2ZpbGVBdmF0YXIiLCJpbWFnZVBvcHVwIiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlQWRkQ2FyZEZvcm1CdXR0b24iLCJwcm9maWxlQXZhdGFyQnV0dG9uIiwiZm9ybVNldHRpbmdzIiwiZWRpdFByb2ZpbGVGb3JtIiwibmFtZUlucHV0IiwicHJvZmVzc2lvbklucHV0IiwidXNlckluZm8iLCJ1c2VyTmFtZSIsInVzZXJBYm91dCIsImF2YXRhciIsIl91c2VyTmFtZSIsIl91c2VyQWJvdXQiLCJfYXZhdGFyIiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsInNldFVzZXJBdmF0YXIiLCJzZXRVc2VySWQiLCJhcGkiLCJvcHRpb25zIiwiY2FyZElkIiwiZmV0Y2giLCJfdXJsIiwibWV0aG9kIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJfdG9rZW4iLCJ0aGVuIiwicmVzcG9uc2UiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJiYXNlVXJsIiwidG9rZW4iLCJwcm9taXNlQ2FyZHNBbmRVc2VyRGF0YSIsImFsbCIsImdldFVzZXJEYXRhIiwiZ2V0SW5pdGlhbENhcmRzIiwicmVzIiwiZWRpdFByb2ZpbGUiLCJhYm91dCIsImFkZE5ld0NhcmQiLCJjb25maXJtYXRpb25Qb3B1cCIsIl9zdWJtaXRIYW5kbGVyIiwic3VibWl0SGFuZGxlciIsImNhbGwiLCJpbWFnZVBvcHVwV2luZG93IiwiaW1hZ2VQb3B1cFRpdGxlRWxlbWVudCIsImltYWdlUG9wdXBJbWFnZUVsZW1lbnQiLCJyZW5kZXJDYXJkIiwiaXRlbSIsIm5ld0NhcmQiLCJyZW1vdmVVc2VyQ2FyZCIsInJlbW92ZUNhcmRFbGVtZW50IiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiZmluYWxseSIsInJlbW92ZUxpa2UiLCJjYXJkIiwiYWRkTGlrZSIsImNhcmRFbGVtZW50IiwiY2FyZFNlY3Rpb24iLCJhZGRJdGVtIiwiY29udGFpbmVyU2VsZWN0b3IiLCJyZW5kZXJlciIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJlbGVtZW50IiwicHJlcGVuZCIsIml0ZW1zIiwiX2l0ZW1zIiwicHJvZmlsZVBvcHVwV2luZG93IiwiYXN5bmMiLCJwcm9mZXNzaW9uIiwicHJvbWlzZUluZm8iLCJyZXNvbHZlIiwiYWRkQ2FyZFBvcHVwV2luZG93IiwiY2FyZHRpdGxlIiwiaW1hZ2VsaW5rIiwiZGF0YSIsImVkaXRBdmF0YXJQb3B1cFdpbmRvdyIsImF2YXRhclVybCIsInNlbmRBdmF0YXIiLCJlZGl0QXZhdGFyIiwiY2FyZEZvcm1WYWxpZGF0b3IiLCJGb3JtVmFsaWRhdG9yIiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJhdmF0YXJGb3JtVmFsaWRhdG9yIiwidXNlckRhdGEiLCJjYXJkcyJdLCJzb3VyY2VSb290IjoiIn0=